>LIST
20     CLEAR R: CLEAR C: CLEAR D: CLEAR O: CLEAR B
30     ONTIME 30,1000 : TIC 1     
100    REM FIRST TIME SETUP
110    LET DIR=0 : LET ROLL=0 : LET IS_ODD=0
190    PRINT "ROLL,IS_ODD,DIR" : REM LOG HEADER
200    REM MAIN LOOP
310    XIL 508 : LIO : ROS 000
320    XIH 508 : OST 000 : GOSUB 10000 : REM POLL EVERY 1/X SEC (SEE MANUAL)
360    IF DIR=0 THEN GOSUB 2000 
370    IF DIR=1 THEN GOSUB 3000
380    IF DIR=2 THEN GOSUB 4000
498    REM END MAIN LOOP
499    GOTO 200
1000   REM SLEEP TIMER
1010   PRINT "TIMER ELAPSED"
1030   RESET : REM TODO: SOMETHING HERE LATER
1040   RETI
2000   REM MOTOR OFF
2010   OTU 000: OTU 001: OTU 002: OTU 003 : RETURN 
3000   REM MOTOR CLOCKWISE
3010   OTU 000: OTU 001: OTL 002: OTL 003 : RETURN 
4000   REM MOTOR COUNTER CLOCKWISE
4010   OTL 000: OTL 001: OTU 002: OTU 003 : RETURN 
5000   REM CHANGE DIRECTION
5010   IF DIR=0 THEN DIR=IS_ODD+1 : RETURN
5020   IF DIR=1 THEN DIR=2 : RETURN
5030   IF DIR=2 THEN DIR=1 : RETURN
5040   DIR=0 : RETURN
10000  REM TICK INTERRUPT START
10020  ROLL=INT(100*ABS(RND)) : REM "ROLL" A RANDOM NUMBER BETWEEN 0-100
10040  IS_ODD=ROLL.AND.1
10050  PRINT ROLL,IS_ODD,DIR : REM PRINT STATE TO SERIAL PORT
10060  IF ROLL<70 THEN RETURN : REM LEAN TOWARDS CURRENT DIRECTION
10070  IF ROLL>=70 .AND. ROLL<80 THEN DIR=0 : REM RANDOMLY STOP
10080  IF ROLL>=80 THEN GOSUB 5000
10100  RETURN

READY
